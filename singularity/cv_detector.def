Bootstrap: docker
From: pytorch/pytorch:1.7.0-cuda11.0-cudnn8-runtime

%files
    ./cv_detector.py /gift/
    ./models.py /gift/
    ./models_wrapper.py /gift/

    ./utils /gift/
    ./detection /gift/
    ./trinv /gift/
    ./config /gift/
    ./config/metaparameters.json /
    ./config/metaparameters_schema.json /
    ./learned_parameters /

%post
    apt update
    # Needed for pycocotools
    apt -y install gcc

    # Needed for cv2
    apt -y install libglib2.0-0 libx11-6
    /opt/conda/bin/pip install torch==1.11 torchvision==0.12
    /opt/conda/bin/conda install jsonpickle
    /opt/conda/bin/pip install pycocotools transformers opencv-python jsonschema jsonargparse jsonpickle scipy
    /opt/conda/bin/conda install scikit-image joblib scikit-learn




%runscript
    exec python3 /gift/cv_detector.py "$@"
